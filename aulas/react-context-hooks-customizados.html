<!-- ==================== Aula React 9 - useContext e Hooks Customizados ==================== -->
<article class="lesson-content">
  <h2><i class="fab fa-react"></i> React ‚Äì useContext e Hooks Customizados</h2>

  <div class="intro-box mb-5">
    <p>
      Nesta aula vamos refatorar nosso projeto de contatos para usar
      <strong>useContext</strong> para gerenciamento de estado global e criar
      <strong>hooks customizados</strong> para organizar melhor a l√≥gica da
      aplica√ß√£o. Vamos manter toda a funcionalidade existente e melhorar a
      organiza√ß√£o do c√≥digo.
    </p>
    <ul>
      <li>
        ‚úÖ Criar ContactsContext para estado global (lista, loading, erro)
      </li>
      <li>
        ‚úÖ Extrair regras para hooks customizados (ex.: useContacts, useFilter,
        useApi)
      </li>
      <li>‚úÖ Manter nos componentes apenas layout e chamada dos hooks</li>
      <li>‚úÖ Organizar pastas (contexts/, hooks/, components/)</li>
      <li>‚úÖ Refatorar projeto existente mantendo funcionalidades</li>
    </ul>
  </div>

  <div class="alert alert-info">
    <strong>Pr√©-requisito:</strong> Esta aula continua o projeto da aula
    anterior "React ‚Äì Consumo de API com axios e useEffect". Certifique-se de
    ter o projeto funcionando com integra√ß√£o de API e localStorage.
  </div>

  <!-- 1. Introdu√ß√£o ao useContext -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-share-alt"></i> 1. Introdu√ß√£o ao useContext
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>1.1 O que √© useContext?</h4>
        <p>
          O <code>useContext</code> permite compartilhar dados entre componentes
          sem precisar passar props manualmente por toda a √°rvore de
          componentes. √â ideal para dados globais como estado da aplica√ß√£o,
          tema, autentica√ß√£o, etc.
        </p>

        <h4>1.2 Por que usar Context?</h4>
        <ul>
          <li>
            <strong>Evita prop drilling:</strong> N√£o precisa passar props por
            v√°rios n√≠veis
          </li>
          <li>
            <strong>Estado global:</strong> Dados acess√≠veis em qualquer
            componente
          </li>
          <li>
            <strong>Organiza√ß√£o:</strong> Separa l√≥gica de neg√≥cio da
            apresenta√ß√£o
          </li>
          <li>
            <strong>Manutenibilidade:</strong> C√≥digo mais limpo e organizado
          </li>
        </ul>

        <h4>1.3 Quando usar Context?</h4>
        <ul>
          <li>
            ‚úÖ Dados que muitos componentes precisam (lista de contatos,
            loading, erro)
          </li>
          <li>‚úÖ Estado global da aplica√ß√£o</li>
          <li>‚úÖ Configura√ß√µes (tema, idioma, autentica√ß√£o)</li>
          <li>‚ùå Estado local simples (useState √© suficiente)</li>
          <li>‚ùå Dados que mudam frequentemente (pode causar re-renders)</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- 2. Criando o ContactsContext -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-cogs"></i> 2. Criando o ContactsContext
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>2.1 Estrutura de Pastas</h4>
        <p>Vamos organizar melhor nosso projeto criando pastas espec√≠ficas:</p>

        <pre><code class="language-plaintext">app/
‚îú‚îÄ‚îÄ page.js
‚îú‚îÄ‚îÄ layout.js
‚îú‚îÄ‚îÄ globals.css
‚îú‚îÄ‚îÄ contact/[id]/page.js
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ContactForm.js
‚îÇ   ‚îú‚îÄ‚îÄ ContactList.js
‚îÇ   ‚îú‚îÄ‚îÄ ContactItem.js
‚îÇ   ‚îú‚îÄ‚îÄ FilterInput.js
‚îÇ   ‚îî‚îÄ‚îÄ Statistcs.js
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îî‚îÄ‚îÄ ContactsContext.js
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useContacts.js
‚îÇ   ‚îú‚îÄ‚îÄ useFilter.js
‚îÇ   ‚îî‚îÄ‚îÄ useApi.js
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ api.js</code></pre>

        <h4>2.2 Criando o Context</h4>
        <pre><code class="language-jsx">// contexts/ContactsContext.js
import { createContext, useContext } from 'react';

// 1. Criar o Context
const ContactsContext = createContext();

// 2. Hook customizado para usar o Context
export const useContactsContext = () => {
  const context = useContext(ContactsContext);
  if (!context) {
    throw new Error('useContactsContext deve ser usado dentro de ContactsProvider');
  }
  return context;
};

// 3. Provider Component
export const ContactsProvider = ({ children, value }) => {
  return (
    &lt;ContactsContext.Provider value={value}&gt;
      {children}
    &lt;/ContactsContext.Provider&gt;
  );
};

export default ContactsContext;</code></pre>
      </div>
    </div>
  </section>

  <!-- 3. Hooks Customizados -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-hook"></i> 3. Hooks Customizados
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>3.1 useContacts - Gerenciamento de Contatos</h4>
        <pre><code class="language-jsx">// hooks/useContacts.js
import { useState, useEffect, useCallback } from 'react';
import api from '../utils/api';

export const useContacts = () => {
  const [contacts, setContacts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isOffline, setIsOffline] = useState(false);

  // Carregar contatos
  const loadContacts = useCallback(async () => {
    try {
      setLoading(true);
      setError(null);
      
      try {
        const response = await api.get('/contacts');
        setContacts(response.data);
        localStorage.setItem('contatos', JSON.stringify(response.data));
        setIsOffline(false);
      } catch (apiError) {
        console.log('API offline, carregando do cache');
        setIsOffline(true);
        const cached = localStorage.getItem('contatos');
        if (cached) {
          setContacts(JSON.parse(cached));
        }
      }
    } catch (err) {
      setError('Erro ao carregar contatos');
    } finally {
      setLoading(false);
    }
  }, []);

  // Adicionar contato
  const addContact = useCallback(async (newContact) => {
    try {
      try {
        const response = await api.post('/contacts', newContact);
        const contactWithId = { ...newContact, id: response.data.id };
        setContacts(prev => [...prev, contactWithId]);
        return contactWithId;
      } catch (apiError) {
        console.log('API offline, salvando localmente');
        const contactWithId = { ...newContact, id: Date.now() };
        setContacts(prev => [...prev, contactWithId]);
        return contactWithId;
      }
    } catch (err) {
      throw new Error('Erro ao adicionar contato');
    }
  }, []);

  // Remover contato
  const removeContact = useCallback(async (id) => {
    try {
      try {
        await api.delete(`/contacts/${id}`);
      } catch (apiError) {
        console.log('API offline, removendo localmente');
      }
      setContacts(prev => prev.filter(c => c.id !== id));
    } catch (err) {
      throw new Error('Erro ao remover contato');
    }
  }, []);

  // Carregar contatos na inicializa√ß√£o
  useEffect(() => {
    loadContacts();
  }, [loadContacts]);

  // Salvar no localStorage quando contatos mudarem
  useEffect(() => {
    if (contacts.length > 0) {
      localStorage.setItem('contatos', JSON.stringify(contacts));
    }
  }, [contacts]);

  return {
    contacts,
    loading,
    error,
    isOffline,
    addContact,
    removeContact,
    loadContacts
  };
};</code></pre>

        <h4>3.2 useFilter - Gerenciamento de Filtros</h4>
        <pre><code class="language-jsx">// hooks/useFilter.js
import { useState, useMemo, useCallback } from 'react';

export const useFilter = (contacts) => {
  const [filter, setFilter] = useState('');

  const handleFilterChange = useCallback((value) => {
    setFilter(value);
  }, []);

  const filteredContacts = useMemo(() => {
    console.log('Filtrando contatos...');
    
    if (!filter.trim()) {
      return contacts;
    }
    
    return contacts.filter(contact =>
      contact.nome.toLowerCase().includes(filter.toLowerCase()) ||
      contact.email.toLowerCase().includes(filter.toLowerCase()) ||
      contact.telefone.includes(filter)
    );
  }, [contacts, filter]);

  return {
    filter,
    filteredContacts,
    handleFilterChange
  };
};</code></pre>

        <h4>3.3 useStatistics - C√°lculo de Estat√≠sticas</h4>
        <pre><code class="language-jsx">// hooks/useStatistics.js
import { useMemo } from 'react';

export const useStatistics = (contacts) => {
  const stats = useMemo(() => {
    console.log('Calculando estat√≠sticas...');
    
    const total = contacts.length;
    const comEmail = contacts.filter(c => c.email).length;
    const comTelefone = contacts.filter(c => c.telefone).length;
    
    return {
      total,
      comEmail,
      comTelefone,
      semEmail: total - comEmail,
      semTelefone: total - comTelefone
    };
  }, [contacts]);

  return stats;
};</code></pre>
      </div>
    </div>
  </section>

  <!-- 4. Refatorando a P√°gina Principal -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-refresh"></i> 4. Refatorando a P√°gina Principal
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>4.1 P√°gina Principal com Context</h4>
        <pre><code class="language-jsx">// app/page.js - REFATORADO com Context e Hooks
"use client";
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistcs from "./components/Statistcs";
import { ContactsProvider } from "./contexts/ContactsContext";
import { useContacts } from "./hooks/useContacts";
import { useFilter } from "./hooks/useFilter";
import { useStatistics } from "./hooks/useStatistics";

// Componente interno que usa os hooks
const ContactsPage = () => {
  const contactsData = useContacts();
  const { filteredContacts, handleFilterChange } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);

  return (
    &lt;div className="min-h-screen bg-gray-200 p-6"&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;FilterInput 
              value={filter} 
              onChange={handleFilterChange} 
            /&gt;
            {contactsData.isOffline && (
              &lt;span className="text-orange-600 text-sm"&gt;
                &lt;i className="fas fa-exclamation-triangle"&gt;&lt;/i&gt; Offline
              &lt;/span&gt;
            )}
          &lt;/div&gt;
        &lt;/header&gt;

        &lt;ContactForm onAdd={contactsData.addContact} /&gt;

        {contactsData.loading && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-spinner fa-spin text-2xl text-blue-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2"&gt;Carregando contatos...&lt;/p&gt;
          &lt;/div&gt;
        )}

        {contactsData.error && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-exclamation-circle text-2xl text-red-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2 text-red-600"&gt;{contactsData.error}&lt;/p&gt;
            &lt;button 
              onClick={contactsData.loadContacts}
              className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            &gt;
              Tentar Novamente
            &lt;/button&gt;
          &lt;/div&gt;
        )}

        {!contactsData.loading && !contactsData.error && (
          &lt;ContactList 
            items={filteredContacts} 
            onRemove={contactsData.removeContact} 
          /&gt;
        )}

        &lt;Statistcs stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

// Componente principal com Provider
const HomePage = () => {
  return (
    &lt;ContactsProvider&gt;
      &lt;ContactsPage /&gt;
    &lt;/ContactsProvider&gt;
  );
};

export default HomePage;</code></pre>
      </div>
    </div>
  </section>

  <!-- 5. Refatorando Componentes -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-puzzle-piece"></i> 5. Refatorando Componentes
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>5.1 ContactForm com Context</h4>
        <pre><code class="language-jsx">// components/ContactForm.js - REFATORADO
import { useEffect, useRef, useState } from "react";
import { useContactsContext } from "../contexts/ContactsContext";

const ContactForm = () => {
  const [form, setForm] = useState({ nome: "", email: "", telefone: "" });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const nomeInputRef = useRef(null);
  
  // Usar o Context em vez de props
  const { addContact } = useContactsContext();

  useEffect(() => {
    nomeInputRef.current?.focus();
  }, []);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!form.nome.trim()) return;

    try {
      setLoading(true);
      setError(null);

      await addContact(form);
      setForm({ nome: "", email: "", telefone: "" });
      nomeInputRef.current?.focus();
      
    } catch (err) {
      setError('Erro ao adicionar contato');
    } finally {
      setLoading(false);
    }
  };

  return (
    &lt;form onSubmit={handleSubmit} className="bg-white shadow rounded p-4 space-y-4"&gt;
      &lt;div&gt;
        &lt;label className="block text-sm font-medium mb-1 text-gray-700"&gt;Nome&lt;/label&gt;
        &lt;input
          ref={nomeInputRef}
          name="nome"
          className="w-full border rounded px-3 py-2 text-gray-900"
          value={form.nome}
          onChange={handleChange}
          required
        /&gt;
      &lt;/div&gt;

      &lt;div&gt;
        &lt;label className="block text-sm font-medium mb-1 text-gray-700"&gt;Email&lt;/label&gt;
        &lt;input
          name="email"
          type="email"
          className="w-full border rounded px-3 py-2 text-gray-900"
          value={form.email}
          onChange={handleChange}
        /&gt;
      &lt;/div&gt;

      &lt;div&gt;
        &lt;label className="block text-sm font-medium mb-1 text-gray-700"&gt;Telefone&lt;/label&gt;
        &lt;input
          name="telefone"
          className="w-full border rounded px-3 py-2 text-gray-900"
          value={form.telefone}
          onChange={handleChange}
        /&gt;
      &lt;/div&gt;

      {error && (
        &lt;div className="text-red-600 text-sm"&gt;{error}&lt;/div&gt;
      )}

      &lt;button 
        type="submit" 
        disabled={loading}
        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded disabled:opacity-50"
      &gt;
        {loading ? 'Salvando...' : 'Adicionar Contato'}
      &lt;/button&gt;
    &lt;/form&gt;
  );
};

export default ContactForm;</code></pre>

        <h4>5.2 ContactItem com Context</h4>
        <pre><code class="language-jsx">// components/ContactItem.js - REFATORADO
import Link from 'next/link';
import { memo } from 'react';
import { useContactsContext } from '../contexts/ContactsContext';

const ContactItem = memo(({ contact }) => {
  const { removeContact } = useContactsContext();

  const handleRemove = async () => {
    try {
      await removeContact(contact.id);
    } catch (err) {
      console.error('Erro ao remover contato:', err);
    }
  };

  return (
    &lt;li className="p-4 flex items-center justify-between"&gt;
      &lt;div&gt;
        &lt;Link
          href={`/contact/${contact.id}`}
          className="font-medium text-gray-900 hover:text-blue-600 transition-colors"
        &gt;
          {contact.nome}
        &lt;/Link&gt;
        &lt;p className="text-sm text-gray-600"&gt;
          {contact.email} ‚Ä¢ {contact.telefone}
        &lt;/p&gt;
      &lt;/div&gt;
      &lt;button
        onClick={handleRemove}
        className="text-red-600 hover:text-red-700 px-2 py-1 rounded"
      &gt;
        Excluir
      &lt;/button&gt;
    &lt;/li&gt;
  );
});

ContactItem.displayName = 'ContactItem';
export default ContactItem;</code></pre>
      </div>
    </div>
  </section>

  <!-- 6. Vantagens da Refatora√ß√£o -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-check-circle"></i> 6. Vantagens da Refatora√ß√£o
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>6.1 Antes vs Depois</h4>

        <h5>‚ùå Antes (Props Drilling)</h5>
        <pre><code class="language-jsx">// P√°gina principal
const HomePage = () => {
  const [contacts, setContacts] = useState([]);
  const [loading, setLoading] = useState(false);
  // ... muita l√≥gica
  
  return (
    &lt;div&gt;
      &lt;ContactForm onAdd={handleAdd} /&gt;
      &lt;ContactList items={contacts} onRemove={handleRemove} /&gt;
      &lt;ContactItem contact={contact} onRemove={handleRemove} /&gt;
    &lt;/div&gt;
  );
};</code></pre>

        <h5>‚úÖ Depois (Context + Hooks)</h5>
        <pre><code class="language-jsx">// P√°gina principal
const HomePage = () => {
  return (
    &lt;ContactsProvider&gt;
      &lt;ContactsPage /&gt;
    &lt;/ContactsProvider&gt;
  );
};

// Componente interno
const ContactsPage = () => {
  const contactsData = useContacts();
  const { filteredContacts } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);
  
  return (
    &lt;div&gt;
      &lt;ContactForm /&gt; {/* Sem props! */}
      &lt;ContactList items={filteredContacts} /&gt;
      &lt;ContactItem contact={contact} /&gt; {/* Sem onRemove! */}
    &lt;/div&gt;
  );
};</code></pre>

        <h4>6.2 Benef√≠cios Alcan√ßados</h4>
        <ul>
          <li>
            ‚úÖ <strong>C√≥digo mais limpo:</strong> Menos props, mais
            legibilidade
          </li>
          <li>
            ‚úÖ <strong>Separa√ß√£o de responsabilidades:</strong> L√≥gica separada
            da apresenta√ß√£o
          </li>
          <li>
            ‚úÖ <strong>Reutiliza√ß√£o:</strong> Hooks podem ser usados em outros
            componentes
          </li>
          <li>
            ‚úÖ <strong>Testabilidade:</strong> Hooks podem ser testados
            isoladamente
          </li>
          <li>
            ‚úÖ <strong>Manutenibilidade:</strong> Mudan√ßas centralizadas no
            Context
          </li>
          <li>
            ‚úÖ <strong>Performance:</strong> Menos re-renders desnecess√°rios
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- 7. Exerc√≠cios Pr√°ticos -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-chalkboard-teacher"></i> 7. Exerc√≠cios Pr√°ticos
    </h3>

    <div class="desafio">
      <h4>Exerc√≠cio 1: Criar ThemeContext</h4>
      <p>
        <strong>Objetivo:</strong> Criar um Context para gerenciar tema
        claro/escuro.
      </p>
      <ol>
        <li>Criar ThemeContext com tema claro/escuro</li>
        <li>Criar hook useTheme</li>
        <li>Implementar toggle de tema</li>
        <li>Aplicar tema nos componentes</li>
      </ol>
      <details class="solucao">
        <summary>Mostrar solu√ß√£o</summary>
        <pre><code class="language-jsx">// 1. ThemeContext (contexts/ThemeContext.js)
import { createContext, useContext, useState, useEffect } from 'react';

const ThemeContext = createContext();

export const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useState('light');

  // Carregar tema do localStorage
  useEffect(() => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setTheme(savedTheme);
    }
  }, []);

  // Salvar tema no localStorage
  useEffect(() => {
    localStorage.setItem('theme', theme);
    document.documentElement.className = theme;
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  const value = {
    theme,
    toggleTheme,
    isDark: theme === 'dark'
  };

  return (
    &lt;ThemeContext.Provider value={value}&gt;
      {children}
    &lt;/ThemeContext.Provider&gt;
  );
};

// 2. Hook useTheme (hooks/useTheme.js)
export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme deve ser usado dentro de ThemeProvider');
  }
  return context;
};

// 3. Componente Toggle (components/ThemeToggle.js)
import { useTheme } from '../hooks/useTheme';

const ThemeToggle = () => {
  const { theme, toggleTheme } = useTheme();

  return (
    &lt;button
      onClick={toggleTheme}
      className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
    &gt;
      {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
    &lt;/button&gt;
  );
};

export default ThemeToggle;

// 4. Aplicar no layout (app/layout.js)
import { ThemeProvider } from './contexts/ThemeContext';

export default function RootLayout({ children }) {
  return (
    &lt;html lang="pt-BR"&gt;
      &lt;body&gt;
        &lt;ThemeProvider&gt;
          {children}
        &lt;/ThemeProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}

// 5. Usar nos componentes
import { useTheme } from '../hooks/useTheme';

const HomePage = () => {
  const { isDark } = useTheme();

  return (
    &lt;div className={`min-h-screen p-6 ${
      isDark ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-900'
    }`}&gt;
      &lt;h1 className="text-2xl font-bold"&gt;Meu App&lt;/h1&gt;
      &lt;ThemeToggle /&gt;
    &lt;/div&gt;
  );
};</code></pre>
      </details>
    </div>

    <div class="desafio">
      <h4>Exerc√≠cio 2: Hook useLocalStorage</h4>
      <p>
        <strong>Objetivo:</strong> Criar hook customizado para localStorage.
      </p>
      <ol>
        <li>Criar hook useLocalStorage</li>
        <li>Implementar sincroniza√ß√£o autom√°tica</li>
        <li>Adicionar tratamento de erros</li>
        <li>Usar no projeto de contatos</li>
      </ol>
      <details class="solucao">
        <summary>Mostrar solu√ß√£o</summary>
        <pre><code class="language-jsx">// 1. Hook useLocalStorage (hooks/useLocalStorage.js)
import { useState, useEffect, useCallback } from 'react';

const useLocalStorage = (key, initialValue) => {
  // Estado para armazenar o valor
  const [storedValue, setStoredValue] = useState(() => {
    try {
      // Tentar obter do localStorage
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(`Erro ao ler localStorage key "${key}":`, error);
      return initialValue;
    }
  });

  // Fun√ß√£o para atualizar o valor
  const setValue = useCallback((value) => {
    try {
      // Permitir que value seja uma fun√ß√£o
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      
      // Salvar no estado
      setStoredValue(valueToStore);
      
      // Salvar no localStorage
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(`Erro ao salvar localStorage key "${key}":`, error);
    }
  }, [key, storedValue]);

  // Fun√ß√£o para remover do localStorage
  const removeValue = useCallback(() => {
    try {
      window.localStorage.removeItem(key);
      setStoredValue(initialValue);
    } catch (error) {
      console.error(`Erro ao remover localStorage key "${key}":`, error);
    }
  }, [key, initialValue]);

  // Sincronizar com mudan√ßas em outras abas
  useEffect(() => {
    const handleStorageChange = (e) => {
      if (e.key === key && e.newValue !== null) {
        try {
          setStoredValue(JSON.parse(e.newValue));
        } catch (error) {
          console.error(`Erro ao sincronizar localStorage key "${key}":`, error);
        }
      }
    };

    window.addEventListener('storage', handleStorageChange);
    return () => window.removeEventListener('storage', handleStorageChange);
  }, [key]);

  return [storedValue, setValue, removeValue];
};

export default useLocalStorage;

// 2. Usar no projeto de contatos (app/page.js)
import { useCallback, useEffect, useMemo, useState } from "react";
import useLocalStorage from './hooks/useLocalStorage';
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistcs from "./components/Statistcs";

const HomePage = () => {
  // Usar hook customizado para localStorage
  const [contacts, setContacts] = useLocalStorage('contatos', []);
  const [filter, setFilter] = useState('');

  // Lista filtrada otimizada
  const filteredContacts = useMemo(() => {
    if (!filter.trim()) {
      return contacts;
    }
    
    return contacts.filter(contact =>
      contact.nome.toLowerCase().includes(filter.toLowerCase()) ||
      contact.email.toLowerCase().includes(filter.toLowerCase()) ||
      contact.telefone.includes(filter)
    );
  }, [contacts, filter]);

  // Estat√≠sticas memoizadas
  const stats = useMemo(() => {
    const total = contacts.length;
    const comEmail = contacts.filter(c => c.email).length;
    const comTelefone = contacts.filter(c => c.telefone).length;
    
    return {
      total,
      comEmail,
      comTelefone,
      semEmail: total - comEmail,
      semTelefone: total - comTelefone
    };
  }, [contacts]);

  // Handlers memoizados
  const handleSubmit = useCallback((newContact) => {
    setContacts(prev => [...prev, { ...newContact, id: Date.now() }]);
  }, [setContacts]);

  const handleRemove = useCallback((id) => {
    setContacts(prev => prev.filter(c => c.id !== id));
  }, [setContacts]);

  const handleFilterChange = useCallback((value) => {
    setFilter(value);
  }, []);

  return (
    &lt;div className="min-h-screen bg-gray-200 p-6"&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;FilterInput value={filter} onChange={handleFilterChange} /&gt;
        &lt;/header&gt;

        &lt;ContactForm onAdd={handleSubmit} /&gt;
        &lt;ContactList items={filteredContacts} onRemove={handleRemove} /&gt;
        &lt;Statistcs stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default HomePage;

// 3. Exemplo de uso com configura√ß√µes
const SettingsPage = () => {
  const [theme, setTheme] = useLocalStorage('theme', 'light');
  const [language, setLanguage] = useLocalStorage('language', 'pt-BR');
  const [notifications, setNotifications] = useLocalStorage('notifications', true);

  return (
    &lt;div className="p-6"&gt;
      &lt;h1 className="text-2xl font-bold mb-6"&gt;Configura√ß√µes&lt;/h1&gt;
      
      &lt;div className="space-y-4"&gt;
        &lt;div&gt;
          &lt;label className="block text-sm font-medium mb-2"&gt;Tema&lt;/label&gt;
          &lt;select 
            value={theme} 
            onChange={(e) => setTheme(e.target.value)}
            className="border rounded px-3 py-2"
          &gt;
            &lt;option value="light"&gt;Claro&lt;/option&gt;
            &lt;option value="dark"&gt;Escuro&lt;/option&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;label className="block text-sm font-medium mb-2"&gt;Idioma&lt;/label&gt;
          &lt;select 
            value={language} 
            onChange={(e) => setLanguage(e.target.value)}
            className="border rounded px-3 py-2"
          &gt;
            &lt;option value="pt-BR"&gt;Portugu√™s&lt;/option&gt;
            &lt;option value="en-US"&gt;English&lt;/option&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;label className="flex items-center"&gt;
            &lt;input 
              type="checkbox" 
              checked={notifications}
              onChange={(e) => setNotifications(e.target.checked)}
              className="mr-2"
            /&gt;
            Receber notifica√ß√µes
          &lt;/label&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};</code></pre>
      </details>
    </div>

    <div class="desafio">
      <h4>Exerc√≠cio 3: Hook useApi</h4>
      <p>
        <strong>Objetivo:</strong> Criar hook gen√©rico para chamadas de API.
      </p>
      <ol>
        <li>Criar hook useApi com loading, error, data</li>
        <li>Implementar cache autom√°tico</li>
        <li>Adicionar retry autom√°tico</li>
        <li>Integrar com o projeto</li>
      </ol>
      <details class="solucao">
        <summary>Mostrar solu√ß√£o</summary>
        <pre><code class="language-jsx">// 1. Hook useApi (hooks/useApi.js)
import { useState, useEffect, useCallback, useRef } from 'react';
import axios from 'axios';

const useApi = (url, options = {}) => {
  const {
    method = 'GET',
    data = null,
    headers = {},
    cache = true,
    retry = 3,
    retryDelay = 1000,
    onSuccess = null,
    onError = null
  } = options;

  const [state, setState] = useState({
    data: null,
    loading: false,
    error: null
  });

  const retryCountRef = useRef(0);
  const cacheKey = `api_${method}_${url}_${JSON.stringify(data)}`;

  // Fun√ß√£o para fazer a requisi√ß√£o
  const makeRequest = useCallback(async (retryAttempt = 0) => {
    try {
      setState(prev => ({ ...prev, loading: true, error: null }));

      // Verificar cache primeiro
      if (cache && method === 'GET') {
        const cached = localStorage.getItem(cacheKey);
        if (cached) {
          const { data: cachedData, timestamp } = JSON.parse(cached);
          const now = Date.now();
          const cacheAge = now - timestamp;
          const cacheExpiry = 5 * 60 * 1000; // 5 minutos

          if (cacheAge < cacheExpiry) {
            setState(prev => ({ ...prev, data: cachedData, loading: false }));
            onSuccess?.(cachedData);
            return cachedData;
          }
        }
      }

      // Fazer requisi√ß√£o
      const config = {
        method,
        url,
        data,
        headers
      };

      const response = await axios(config);
      const responseData = response.data;

      // Salvar no cache
      if (cache && method === 'GET') {
        localStorage.setItem(cacheKey, JSON.stringify({
          data: responseData,
          timestamp: Date.now()
        }));
      }

      setState(prev => ({ ...prev, data: responseData, loading: false }));
      onSuccess?.(responseData);
      retryCountRef.current = 0;

      return responseData;

    } catch (error) {
      const errorMessage = error.response?.data?.message || error.message;

      // Tentar novamente se ainda h√° tentativas
      if (retryAttempt < retry) {
        retryCountRef.current = retryAttempt + 1;
        setTimeout(() => {
          makeRequest(retryAttempt + 1);
        }, retryDelay * Math.pow(2, retryAttempt)); // Backoff exponencial
        return;
      }

      setState(prev => ({ 
        ...prev, 
        error: errorMessage, 
        loading: false 
      }));
      onError?.(error);
      retryCountRef.current = 0;
    }
  }, [url, method, data, headers, cache, retry, retryDelay, cacheKey, onSuccess, onError]);

  // Fun√ß√£o para refazer a requisi√ß√£o
  const refetch = useCallback(() => {
    retryCountRef.current = 0;
    makeRequest(0);
  }, [makeRequest]);

  // Fun√ß√£o para limpar cache
  const clearCache = useCallback(() => {
    if (cache && method === 'GET') {
      localStorage.removeItem(cacheKey);
    }
  }, [cache, method, cacheKey]);

  // Executar requisi√ß√£o quando depend√™ncias mudarem
  useEffect(() => {
    makeRequest(0);
  }, [makeRequest]);

  return {
    ...state,
    refetch,
    clearCache,
    retryCount: retryCountRef.current
  };
};

export default useApi;

// 2. Usar no projeto de contatos (app/page.js)
import { useCallback, useMemo, useState } from "react";
import useApi from './hooks/useApi';
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistcs from "./components/Statistcs";

const HomePage = () => {
  const [filter, setFilter] = useState('');

  // Usar hook useApi para carregar contatos
  const { 
    data: contacts = [], 
    loading, 
    error, 
    refetch 
  } = useApi('https://68d96d1b90a75154f0da61ae.mockapi.io/contacts', {
    onSuccess: (data) => {
      console.log('Contatos carregados:', data);
    },
    onError: (error) => {
      console.error('Erro ao carregar contatos:', error);
    }
  });

  // Lista filtrada otimizada
  const filteredContacts = useMemo(() => {
    if (!filter.trim()) {
      return contacts;
    }
    
    return contacts.filter(contact =>
      contact.nome.toLowerCase().includes(filter.toLowerCase()) ||
      contact.email.toLowerCase().includes(filter.toLowerCase()) ||
      contact.telefone.includes(filter)
    );
  }, [contacts, filter]);

  // Estat√≠sticas memoizadas
  const stats = useMemo(() => {
    const total = contacts.length;
    const comEmail = contacts.filter(c => c.email).length;
    const comTelefone = contacts.filter(c => c.telefone).length;
    
    return {
      total,
      comEmail,
      comTelefone,
      semEmail: total - comEmail,
      semTelefone: total - comTelefone
    };
  }, [contacts]);

  // Handlers
  const handleSubmit = useCallback((newContact) => {
    // Aqui voc√™ faria uma requisi√ß√£o POST para adicionar o contato
    console.log('Adicionar contato:', newContact);
    refetch(); // Recarregar dados
  }, [refetch]);

  const handleRemove = useCallback((id) => {
    // Aqui voc√™ faria uma requisi√ß√£o DELETE para remover o contato
    console.log('Remover contato:', id);
    refetch(); // Recarregar dados
  }, [refetch]);

  const handleFilterChange = useCallback((value) => {
    setFilter(value);
  }, []);

  if (loading) {
    return (
      &lt;div className="min-h-screen bg-gray-200 p-6 flex items-center justify-center"&gt;
        &lt;div className="text-center"&gt;
          &lt;i className="fas fa-spinner fa-spin text-4xl text-blue-600"&gt;&lt;/i&gt;
          &lt;p className="mt-4 text-lg"&gt;Carregando contatos...&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }

  if (error) {
    return (
      &lt;div className="min-h-screen bg-gray-200 p-6 flex items-center justify-center"&gt;
        &lt;div className="text-center"&gt;
          &lt;i className="fas fa-exclamation-circle text-4xl text-red-600"&gt;&lt;/i&gt;
          &lt;p className="mt-4 text-lg text-red-600"&gt;{error}&lt;/p&gt;
          &lt;button 
            onClick={refetch}
            className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
          &gt;
            Tentar Novamente
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }

  return (
    &lt;div className="min-h-screen bg-gray-200 p-6"&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;FilterInput value={filter} onChange={handleFilterChange} /&gt;
            &lt;button
              onClick={refetch}
              className="text-blue-600 hover:text-blue-800"
              title="Recarregar dados"
            &gt;
              &lt;i className="fas fa-sync-alt"&gt;&lt;/i&gt;
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/header&gt;

        &lt;ContactForm onAdd={handleSubmit} /&gt;
        &lt;ContactList items={filteredContacts} onRemove={handleRemove} /&gt;
        &lt;Statistcs stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default HomePage;

// 3. Exemplo de uso com diferentes endpoints
const Dashboard = () => {
  // Carregar usu√°rios
  const { data: users, loading: usersLoading } = useApi('https://jsonplaceholder.typicode.com/users');
  
  // Carregar posts
  const { data: posts, loading: postsLoading } = useApi('https://jsonplaceholder.typicode.com/posts');
  
  // Carregar TODOs
  const { data: todos, loading: todosLoading } = useApi('https://jsonplaceholder.typicode.com/todos');

  const loading = usersLoading || postsLoading || todosLoading;

  if (loading) {
    return &lt;div&gt;Carregando...&lt;/div&gt;;
  }

  return (
    &lt;div className="p-6"&gt;
      &lt;h1 className="text-2xl font-bold mb-6"&gt;Dashboard&lt;/h1&gt;
      &lt;div className="grid grid-cols-3 gap-6"&gt;
        &lt;div className="bg-white p-4 rounded shadow"&gt;
          &lt;h3 className="text-lg font-semibold"&gt;Usu√°rios&lt;/h3&gt;
          &lt;p className="text-3xl font-bold text-blue-600"&gt;{users?.length || 0}&lt;/p&gt;
        &lt;/div&gt;
        &lt;div className="bg-white p-4 rounded shadow"&gt;
          &lt;h3 className="text-lg font-semibold"&gt;Posts&lt;/h3&gt;
          &lt;p className="text-3xl font-bold text-green-600"&gt;{posts?.length || 0}&lt;/p&gt;
        &lt;/div&gt;
        &lt;div className="bg-white p-4 rounded shadow"&gt;
          &lt;h3 className="text-lg font-semibold"&gt;TODOs&lt;/h3&gt;
          &lt;p className="text-3xl font-bold text-purple-600"&gt;{todos?.length || 0}&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};</code></pre>
      </details>
    </div>
  </section>

  <!-- 8. Pr√≥ximos Passos -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-arrow-right"></i> 8. Pr√≥ximos Passos
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>8.1 Melhorias Futuras</h4>
        <ul>
          <li>
            üîÆ <strong>React Query:</strong> Para cache e sincroniza√ß√£o de dados
          </li>
          <li>
            üîÆ <strong>Zustand:</strong> Para gerenciamento de estado mais
            simples
          </li>
          <li>
            üîÆ <strong>Redux Toolkit:</strong> Para aplica√ß√µes mais complexas
          </li>
          <li>
            üîÆ <strong>React Hook Form:</strong> Para formul√°rios mais robustos
          </li>
        </ul>

        <h4>8.2 Padr√µes Avan√ßados</h4>
        <ul>
          <li>
            üîÆ <strong>Compound Components:</strong> Componentes compostos
          </li>
          <li>üîÆ <strong>Render Props:</strong> Padr√£o de renderiza√ß√£o</li>
          <li>
            üîÆ <strong>Higher-Order Components:</strong> Componentes de alta
            ordem
          </li>
          <li>
            üîÆ <strong>Custom Hooks Library:</strong> Biblioteca de hooks
            reutiliz√°veis
          </li>
        </ul>
      </div>
    </div>
  </section>
</article>
