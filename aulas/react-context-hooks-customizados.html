<!-- ==================== Aula React 9 - useContext e Hooks Customizados ==================== -->
<article class="lesson-content">
  <h2><i class="fab fa-react"></i> React ‚Äì useContext e Hooks Customizados</h2>

  <div class="intro-box mb-5">
    <p>
      <strong
        >üöÄ Transforme seu c√≥digo React em uma arquitetura profissional!</strong
      >
    </p>
    <p>
      Nesta aula vamos refatorar nosso projeto de contatos para usar
      <strong>useContext</strong> e <strong>hooks customizados</strong>,
      eliminando o prop drilling e criando uma estrutura de c√≥digo mais limpa e
      organizada. Mantemos todas as funcionalidades avan√ßadas (API, cache
      offline, sincroniza√ß√£o) e ganhamos em manutenibilidade e escalabilidade.
    </p>
  </div>

  <blockquote>
    <p>
      "Context √© sobre compartilhar dados sem passar por cada n√≠vel da √°rvore de
      componentes." - React Team
    </p>
  </blockquote>

  <div class="alert alert-info">
    <strong>Pr√©-requisito:</strong> Projeto da aula anterior "React ‚Äì Consumo de
    API com axios e useEffect" funcionando com MockAPI, cache offline e
    sincroniza√ß√£o.
  </div>

  <!-- 1. Introdu√ß√£o ao useContext -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-share-alt"></i> 1. Introdu√ß√£o ao useContext
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>1.1 O que √© useContext?</h4>
        <p>
          O <code>useContext</code> permite compartilhar dados entre componentes
          sem precisar passar props manualmente por toda a √°rvore de
          componentes. √â ideal para dados globais como estado da aplica√ß√£o,
          tema, autentica√ß√£o, etc.
        </p>

        <div class="text-center mb-4">
          <img
            src="assets/images/use_context.webp"
            alt="Representa√ß√£o visual do useContext"
            class="img-fluid rounded shadow"
          />
          <p class="text-muted mt-2">
            <small>Representa√ß√£o visual de como o useContext funciona</small>
          </p>
        </div>

        <h4>1.2 Por que usar Context?</h4>
        <ul>
          <li>
            <strong>Evita prop drilling:</strong> N√£o precisa passar props por
            v√°rios n√≠veis
          </li>
          <li>
            <strong>Estado global:</strong> Dados acess√≠veis em qualquer
            componente
          </li>
          <li>
            <strong>Organiza√ß√£o:</strong> Separa l√≥gica de neg√≥cio da
            apresenta√ß√£o
          </li>
          <li>
            <strong>Manutenibilidade:</strong> C√≥digo mais limpo e organizado
          </li>
        </ul>

        <h4>1.3 Quando usar Context?</h4>
        <ul>
          <li>
            ‚úÖ Dados que muitos componentes precisam (lista de contatos,
            loading, erro)
          </li>
          <li>‚úÖ Estado global da aplica√ß√£o</li>
          <li>‚úÖ Configura√ß√µes (tema, idioma, autentica√ß√£o)</li>
          <li>‚ùå Estado local simples (useState √© suficiente)</li>
          <li>‚ùå Dados que mudam frequentemente (pode causar re-renders)</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- 2. Criando o ContactsContext -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-cogs"></i> 2. Criando o ContactsContext
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>2.1 Evolu√ß√£o da Estrutura do Projeto</h4>
        <p>
          Vamos partir da estrutura atual da aula anterior e evoluir para uma
          organiza√ß√£o com Context e hooks customizados:
        </p>

        <pre><code class="language-plaintext">app/
‚îú‚îÄ‚îÄ page.js                    # ‚úÖ MODIFICAR: P√°gina principal (refatorada com Context)
‚îú‚îÄ‚îÄ layout.js                  # ‚úÖ MODIFICAR: Layout compartilhado (com ContactsProvider)
‚îú‚îÄ‚îÄ globals.css                # ‚úÖ MANTER: Estilos globais
‚îú‚îÄ‚îÄ contact/[id]/page.js       # ‚úÖ MODIFICAR: P√°gina de detalhes (usa useContactDetail)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ContactForm.jsx        # ‚úÖ MODIFICAR: Formul√°rio (usa useForm)
‚îÇ   ‚îú‚îÄ‚îÄ ContactList.jsx        # ‚úÖ MANTER: Lista de contatos
‚îÇ   ‚îú‚îÄ‚îÄ ContactItem.jsx        # ‚úÖ MODIFICAR: Item individual (usa useForm)
‚îÇ   ‚îú‚îÄ‚îÄ FilterInput.jsx        # ‚úÖ MANTER: Campo de filtro
‚îÇ   ‚îú‚îÄ‚îÄ Statistics.jsx         # ‚úÖ MANTER: Estat√≠sticas
‚îÇ   ‚îî‚îÄ‚îÄ ConnectionStatus.jsx   # ‚úÖ MODIFICAR: Status de conex√£o (usa useConnectionStatus)
‚îú‚îÄ‚îÄ contexts/                  # üÜï NOVA PASTA para Context
‚îÇ   ‚îî‚îÄ‚îÄ ContactsContext.js     # üÜï NOVO: Context de contatos (com getContact)
‚îú‚îÄ‚îÄ hooks/                     # üÜï NOVA PASTA para hooks customizados
‚îÇ   ‚îú‚îÄ‚îÄ useFilter.js           # üÜï NOVO: Hook para filtros
‚îÇ   ‚îú‚îÄ‚îÄ useStatistics.js       # üÜï NOVO: Hook para estat√≠sticas
‚îÇ   ‚îú‚îÄ‚îÄ useConnectionStatus.js # üÜï NOVO: Hook para status de conex√£o
‚îÇ   ‚îú‚îÄ‚îÄ useContactDetail.js    # üÜï NOVO: Hook para buscar contato espec√≠fico
‚îÇ   ‚îî‚îÄ‚îÄ useForm.js             # üÜï NOVO: Hook para gerenciar formul√°rios
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ api.js                 # ‚úÖ MANTER: Configura√ß√£o do axios
    ‚îî‚îÄ‚îÄ cache.js               # ‚úÖ MANTER: Servi√ßo de cache com expira√ß√£o</code></pre>

        <div class="alert alert-info">
          <strong>Legenda:</strong>
          <ul>
            <li>
              ‚úÖ <strong>MANTER:</strong> Arquivos que existiam na aula anterior
              e permanecem inalterados
            </li>
            <li>
              ‚úÖ <strong>MODIFICAR:</strong> Arquivos que existiam na aula
              anterior mas precisam ser atualizados
            </li>
            <li>
              üÜï <strong>NOVO:</strong> Arquivos e pastas criados nesta aula
            </li>
          </ul>
        </div>

        <h4>2.2 Criando o Context</h4>
        <p>
          Vamos criar um Context que encapsula toda a l√≥gica de contatos da aula
          anterior:
        </p>

        <pre><code class="language-jsx">// contexts/ContactsContext.js (NOVO ARQUIVO)
import { createContext, useContext, useState, useEffect, useCallback } from 'react';
import api from '../utils/api';
import { cacheService } from '../utils/cache';

// 1. Criar o Context
const ContactsContext = createContext();

// 2. Hook customizado para usar o Context
export const useContactsContext = () => {
  const context = useContext(ContactsContext);
  if (!context) {
    throw new Error('useContactsContext deve ser usado dentro de ContactsProvider');
  }
  return context;
};

// 3. Provider Component
export const ContactsProvider = ({ children }) => {
  const [contacts, setContacts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isOffline, setIsOffline] = useState(false);
  
  const loadContacts = useCallback(async () => {
    let isMounted = true;

    try {
      if (isMounted) {
        setLoading(true);
        setError(null);
      }
      
      // Verificar cache primeiro
      const cachedContacts = cacheService.get();
      if (cachedContacts && isMounted) {
        setContacts(cachedContacts);
        setLoading(false);
      }
      
      // Tentar carregar da API
      try {
        const response = await api.get('/contacts');
        const apiContacts = response.data;
        
        if (isMounted) {
          // Salvar no cache service
          cacheService.set(apiContacts);
          setContacts(apiContacts);
          setIsOffline(false);
        }
      } catch (apiError) {
        // Se API falhar e n√£o h√° cache, mostrar erro
        if (isMounted) {
          if (!cachedContacts) {
            setIsOffline(true);
            setError('Erro ao carregar contatos e sem cache dispon√≠vel.');
          } else {
            setIsOffline(true);
            console.log('API offline, usando cache');
          }
        }
      }
    } catch (err) {
      if (isMounted) {
        setError('Erro ao carregar contatos');
      }
    } finally {
      if (isMounted) {
        setLoading(false);
      }
    }
  }, []);

  const addContact = useCallback(async (newContact) => {
    try {
      // Tentar salvar via API primeiro
      try {
        const response = await api.post('/contacts', newContact);
        const contactWithId = { ...newContact, id: response.data.id };
        setContacts(prev => {
          const updated = [...prev, contactWithId];
          cacheService.set(updated);
          return updated;
        });
        return contactWithId;
      } catch (apiError) {
        // Se API falhar, salvar localmente
        console.log('API offline, salvando localmente');
        const contactWithId = { ...newContact, id: Date.now() };
        setContacts(prev => {
          const updated = [...prev, contactWithId];
          cacheService.set(updated);
          return updated;
        });
        return contactWithId;
      }
    } catch (err) {
      throw new Error('Erro ao adicionar contato');
    }
  }, []);

  const removeContact = useCallback(async (id) => {
    try {
      // Tentar excluir via API primeiro
      try {
        await api.delete(`/contacts/${id}`);
        console.log('Contato exclu√≠do da API');
      } catch (apiError) {
        // Se API falhar, apenas remover localmente
        console.log('API offline, removendo apenas localmente');
      }
      
      // Remover da lista local em ambos os casos
      setContacts(prev => {
        const updated = prev.filter(c => c.id !== id);
        // Atualizar cache
        cacheService.set(updated);
        return updated;
      });
    } catch (err) {
      console.error('Erro ao remover contato:', err);
      throw new Error('Erro ao remover contato');
    }
  }, []);

  useEffect(() => {
    const syncPendingContacts = async () => {
      try {
        // Buscar contatos da API
        const response = await api.get('/contacts');
        const serverContacts = response.data;
        
        // Buscar contatos locais
        const localContacts = contacts;
        
        // Encontrar contatos que existem localmente mas n√£o no servidor
        const pendingContacts = localContacts.filter(localContact => {
          // Se o ID √© um timestamp (salvo offline), precisa sincronizar
          return typeof localContact.id === 'number' && 
                 localContact.id > 1000000000000 && // Timestamp v√°lido
                 !serverContacts.some(serverContact => 
                   serverContact.nome === localContact.nome &&
                   serverContact.email === localContact.email &&
                   serverContact.telefone === localContact.telefone
                 );
        });

        // Enviar contatos pendentes para a API
        for (const pendingContact of pendingContacts) {
          try {
            const { id, ...contactData } = pendingContact;
            const response = await api.post('/contacts', contactData);
            
            // Atualizar o contato local com o ID da API
            setContacts(prev => prev.map(contact => 
              contact.id === pendingContact.id 
                ? { ...contact, id: response.data.id }
                : contact
            ));
            
            console.log('Contato sincronizado:', contactData.nome);
          } catch (err) {
            console.error('Erro ao sincronizar contato:', err);
          }
        }

        // Atualizar com dados do servidor
        setContacts(serverContacts);
        cacheService.set(serverContacts);
        
      } catch (err) {
        console.error('Erro na sincroniza√ß√£o:', err);
      }
    };

    const handleOnline = () => {
      setIsOffline(false);
      console.log('Voltou online - sincronizando...');
      syncPendingContacts();
    };

    const handleOffline = () => {
      setIsOffline(true);
      console.log('Ficou offline - usando cache local');
    };

    // Verificar status inicial
    setIsOffline(!navigator.onLine);

    // Adicionar listeners
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, [contacts]);

  // Buscar contato espec√≠fico por ID
  const getContact = useCallback(async (id) => {
    try {
      // Primeiro, tentar buscar da API
      try {
        const response = await api.get(`/contacts/${id}`);
        return response.data;
      } catch (apiError) {
        // Se API falhar, buscar do cache local
        console.log('API offline, buscando do cache local');
        const cachedContacts = cacheService.get();
        if (cachedContacts) {
          const foundContact = cachedContacts.find(c => c.id === parseInt(id));
          if (foundContact) {
            return foundContact;
          }
        }
        throw new Error('Contato n√£o encontrado');
      }
    } catch (err) {
      console.error('Erro ao buscar contato:', err);
      throw err;
    }
  }, []);

  // Carregar contatos na inicializa√ß√£o
  useEffect(() => {
    loadContacts();
  }, [loadContacts]);

  // Valor do Context
  const value = {
    contacts,
    loading,
    error,
    isOffline,
    addContact,
    removeContact,
    loadContacts,
    getContact
  };

  return (
    &lt;ContactsContext.Provider value={value}&gt;
      {children}
    &lt;/ContactsContext.Provider&gt;
  );
};

export default ContactsContext;</code></pre>
      </div>
    </div>
  </section>

  <!-- 3. Hooks Customizados -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-hook"></i> 3. Hooks Customizados
    </h3>

    <div style="text-align: center; margin-bottom: 2rem; width: 100%">
      <img
        src="assets/images/react_hooks.jpeg"
        alt="Selo Homem Aranha de Qualidade - React Hooks"
        class="rounded shadow"
        style="
          max-width: 600px;
          width: 100%;
          height: auto;
          display: block;
          margin: 0 auto;
        "
      />
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <h4>3.1 useFilter - Gerenciamento de Filtros</h4>
        <p>
          Como toda a l√≥gica de contatos agora est√° no Context, vamos criar
          hooks mais espec√≠ficos:
        </p>

        <pre><code class="language-jsx">// hooks/useFilter.js (NOVO ARQUIVO)
import { useState, useMemo, useCallback } from 'react';

export const useFilter = (contacts) => {
  const [filter, setFilter] = useState('');

  const handleFilterChange = useCallback((value) => {
    setFilter(value);
  }, []);

  const filteredContacts = useMemo(() => {
    console.log('Filtrando contatos...');
    
    if (!filter.trim()) {
      return contacts;
    }
    
    return contacts.filter(contact =>
      contact.nome.toLowerCase().includes(filter.toLowerCase()) ||
      contact.email.toLowerCase().includes(filter.toLowerCase()) ||
      contact.telefone.includes(filter)
    );
  }, [contacts, filter]);

  return {
    filter,
    filteredContacts,
    handleFilterChange
  };
};</code></pre>

        <h4>3.2 useStatistics - C√°lculo de Estat√≠sticas</h4>
        <pre><code class="language-jsx">// hooks/useStatistics.js (NOVO ARQUIVO)
import { useMemo } from 'react';

export const useStatistics = (contacts) => {
  const stats = useMemo(() => {
    console.log('Calculando estat√≠sticas...');
    
    const total = contacts.length;
    const comEmail = contacts.filter(c => c.email).length;
    const comTelefone = contacts.filter(c => c.telefone).length;
    
    return {
      total,
      comEmail,
      comTelefone,
      semEmail: total - comEmail,
      semTelefone: total - comTelefone
    };
  }, [contacts]);

  return stats;
};</code></pre>

        <h4>3.3 useContactDetail - Busca de Contato Espec√≠fico</h4>
        <p>Hook para buscar um contato espec√≠fico por ID, usando o Context:</p>

        <pre><code class="language-jsx">// hooks/useContactDetail.js (NOVO ARQUIVO)
import { useState, useEffect } from 'react';
import { useParams } from 'next/navigation';
import { useContactsContext } from '../contexts/ContactsContext';

export const useContactDetail = () => {
    const params = useParams();
    const { getContact } = useContactsContext();
    const [contact, setContact] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        const fetchContact = async () => {
            try {
                setLoading(true);
                setError(null);

                const contactData = await getContact(params.id);
                setContact(contactData);
            } catch (err) {
                console.error('Erro ao buscar contato:', err);
                setError(err.message || 'Erro ao carregar contato');
            } finally {
                setLoading(false);
            }
        };

        if (params.id) {
            fetchContact();
        }
    }, [params.id, getContact]);

    return {
        contact,
        loading,
        error
    };
};</code></pre>

        <h4>3.4 useForm - Gerenciamento de Formul√°rios</h4>
        <p>
          Hook para gerenciar formul√°rios, extra√≠do da l√≥gica do ContactForm:
        </p>

        <pre><code class="language-jsx">// hooks/useForm.js (NOVO ARQUIVO)
import { useEffect, useRef, useState } from "react";
import { useContactsContext } from "../contexts/ContactsContext";
import { useRouter } from "next/router";
import { useParams } from "next/navigation";

export const useForm = () => {
    const [form, setForm] = useState({ nome: "", email: "", telefone: "" });
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState(null);
    const nomeInputRef = useRef(null);

    const { addContact, removeContact, contacts, loadContacts } = useContactsContext();

    useEffect(() => {
        nomeInputRef.current?.focus();
    }, []);

    useEffect(() => {
        return () => {
            console.log('ContactForm desmontado');
        };
    }, []);

    const handleChange = (e) => {
        const { name, value } = e.target;
        setForm((prev) => ({ ...prev, [name]: value }));
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!form.nome.trim()) return; // Valida√ß√£o simples

        try {
            setLoading(true);
            setError(null);

            await addContact(form);
            setForm({ nome: "", email: "", telefone: "" });
            nomeInputRef.current?.focus();

        } catch (err) {
            setError('Erro ao adicionar contato');
        } finally {
            setLoading(false);
        }
    };

    const handleRemove = async (id) => {
        try {
            await removeContact(id);
        } catch (err) {
            console.error('Erro ao remover contato:', err);
        }
    };

    return {
        form,
        loading,
        error,
        handleChange,
        handleSubmit,
        nomeInputRef,
        handleRemove
    };
}</code></pre>

        <h4>3.5 useConnectionStatus - Status de Conex√£o</h4>
        <p>
          Hook para gerenciar o status de conex√£o, extra√≠do da aula anterior:
        </p>

        <pre><code class="language-jsx">// hooks/useConnectionStatus.js (NOVO ARQUIVO)
import { useState, useEffect } from 'react';

export const useConnectionStatus = () => {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [showStatus, setShowStatus] = useState(false);

  useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      setShowStatus(true);
      // Esconder status ap√≥s 3 segundos
      setTimeout(() => setShowStatus(false), 3000);
    };

    const handleOffline = () => {
      setIsOnline(false);
      setShowStatus(true);
    };

    // Verificar status inicial
    setIsOnline(navigator.onLine);

    // Adicionar listeners
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  return {
    isOnline,
    showStatus,
    setIsOnline,
    setShowStatus
  };
};</code></pre>
      </div>
    </div>
  </section>

  <!-- 4. Refatorando a P√°gina Principal -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-refresh"></i> 4. Refatorando a P√°gina Principal
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>4.1 P√°gina Principal com Context</h4>
        <p>
          Vamos refatorar a p√°gina principal para usar Context e hooks, mantendo
          todas as funcionalidades da aula anterior:
        </p>

        <pre><code class="language-jsx">// app/layout.js (MODIFICAR ARQUIVO EXISTENTE)
"use client";
import "./globals.css";
import { ContactsProvider } from "./contexts/ContactsContext";

export default function RootLayout({ children }) {
  return (
    &lt;html lang="en"&gt;
      &lt;body&gt;
        &lt;ContactsProvider&gt;
          {children}
        &lt;/ContactsProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}</code></pre>

        <pre><code class="language-jsx">// app/page.js (MODIFICAR ARQUIVO EXISTENTE)
"use client";

//Components
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistcs from "./components/Statistcs";
import ConnectionStatus from "./components/ConnectionStatus";

//Hooks
import { useFilter } from "./hooks/useFilter";
import { useStatistics } from "./hooks/useStatistics";

//Contexts
import { useContactsContext } from "./contexts/ContactsContext";

const HomePage = () => {
  // Usar Context em vez de props
  const contactsData = useContactsContext();
  const { filter, filteredContacts, handleFilterChange } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);

  return (
    &lt;div className="min-h-screen bg-gray-200 p-6"&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;FilterInput
              value={filter}
              onChange={handleFilterChange}
            /&gt;
            &lt;ConnectionStatus /&gt;
          &lt;/div&gt;
        &lt;/header&gt;

        &lt;ContactForm /&gt;

        {/* Estados de loading e erro mantidos da aula anterior */}
        {contactsData.loading && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-spinner fa-spin text-2xl text-blue-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2"&gt;Carregando contatos...&lt;/p&gt;
          &lt;/div&gt;
        )}

        {contactsData.error && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-exclamation-circle text-2xl text-red-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2 text-red-600"&gt;{contactsData.error}&lt;/p&gt;
            &lt;button
              onClick={contactsData.loadContacts}
              className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            &gt;
              Tentar Novamente
            &lt;/button&gt;
          &lt;/div&gt;
        )}

        {/* Renderiza√ß√£o condicional mantida da aula anterior */}
        {!contactsData.loading && !contactsData.error && (
          &lt;ContactList
            items={filteredContacts}
            onRemove={contactsData.removeContact}
          /&gt;
        )}

        &lt;Statistcs stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default HomePage;</code></pre>
      </div>
    </div>
  </section>

  <!-- 5. Refatorando Componentes -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-puzzle-piece"></i> 5. Refatorando Componentes
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>5.1 ContactForm com Hook Customizado</h4>
        <p>
          Vamos refatorar o ContactForm para usar o hook useForm, mantendo todas
          as funcionalidades da aula anterior:
        </p>

        <pre><code class="language-jsx">// components/ContactForm.jsx (MODIFICAR ARQUIVO EXISTENTE)
import { useForm } from "../hooks/useForm";

const ContactForm = () => {
    const { form, loading, error, handleChange, handleSubmit, nomeInputRef } = useForm();

    return (
        &lt;form onSubmit={handleSubmit} className="bg-white shadow rounded p-4 space-y-4"&gt;
            &lt;div&gt;
                &lt;label className="block text-sm font-medium mb-1 text-gray-700"&gt;Nome&lt;/label&gt;
                &lt;input
                    ref={nomeInputRef}
                    name="nome"
                    className="w-full border rounded px-3 py-2 text-gray-900"
                    value={form.nome}
                    onChange={handleChange}
                    required
                /&gt;
            &lt;/div&gt;

            &lt;div&gt;
                &lt;label className="block text-sm font-medium mb-1 text-gray-700"&gt;Email&lt;/label&gt;
                &lt;input
                    name="email"
                    type="email"
                    className="w-full border rounded px-3 py-2 text-gray-900"
                    value={form.email}
                    onChange={handleChange}
                /&gt;
            &lt;/div&gt;

            &lt;div&gt;
                &lt;label className="block text-sm font-medium mb-1 text-gray-700"&gt;Telefone&lt;/label&gt;
                &lt;input
                    name="telefone"
                    className="w-full border rounded px-3 py-2 text-gray-900"
                    value={form.telefone}
                    onChange={handleChange}
                /&gt;
            &lt;/div&gt;

            {error && (
                &lt;div className="text-red-600 text-sm"&gt;{error}&lt;/div&gt;
            )}

            &lt;button
                type="submit"
                disabled={loading}
                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded disabled:opacity-50"
            &gt;
                {loading ? 'Salvando...' : 'Adicionar Contato'}
            &lt;/button&gt;
        &lt;/form&gt;
    );
};

export default ContactForm;</code></pre>

        <h4>5.2 ContactItem com Hook Customizado</h4>
        <p>
          Vamos refatorar o ContactItem para usar o hook useForm, mantendo memo
          e navega√ß√£o:
        </p>

        <pre><code class="language-jsx">// components/ContactItem.jsx (MODIFICAR ARQUIVO EXISTENTE)
import Link from 'next/link';
import { memo } from 'react';
import { useForm } from '../hooks/useForm';

const ContactItem = memo(({ contact }) => {
    const { handleRemove } = useForm();

    return (
        &lt;li className="p-4 flex items-center justify-between"&gt;
            &lt;div&gt;
                &lt;Link
                    href={`/contact/${contact.id}`}
                    className="font-medium text-gray-900 hover:text-blue-600 transition-colors"
                &gt;
                    {contact.nome}
                &lt;/Link&gt;
                &lt;p className="text-sm text-gray-600"&gt;
                    {contact.email} ‚Ä¢ {contact.telefone}
                &lt;/p&gt;
            &lt;/div&gt;
            &lt;button
                onClick={() =&gt; handleRemove(contact.id)}
                className="text-red-600 hover:text-red-700 px-2 py-1 rounded cursor-pointer"
            &gt;
                Excluir
            &lt;/button&gt;
        &lt;/li&gt;
    );
});

ContactItem.displayName = 'ContactItem';

export default ContactItem;</code></pre>

        <h4>5.3 P√°gina de Detalhes com Hook Customizado</h4>
        <p>
          Vamos refatorar a p√°gina de detalhes para usar o hook
          useContactDetail, mantendo todas as funcionalidades da aula anterior:
        </p>

        <pre><code class="language-jsx">// app/contact/[id]/page.js (MODIFICAR ARQUIVO EXISTENTE)
"use client";

import { useRouter } from 'next/navigation';
import { useContactDetail } from '../../hooks/useContactDetail';

const ContactDetailPage = () => {
    const router = useRouter();
    const { contact, loading, error } = useContactDetail();

    if (loading) {
        return (
            &lt;div className="min-h-screen bg-gray-50 p-6"&gt;
                &lt;div className="max-w-2xl mx-auto"&gt;
                    &lt;div className="bg-white shadow rounded-lg p-6"&gt;
                        &lt;div className="flex items-center justify-center"&gt;
                            &lt;i className="fas fa-spinner fa-spin text-2xl text-blue-600 mr-3"&gt;&lt;/i&gt;
                            &lt;p className="text-gray-600"&gt;Carregando contato...&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }

    if (error || !contact) {
        return (
            &lt;div className="min-h-screen bg-gray-50 p-6"&gt;
                &lt;div className="max-w-2xl mx-auto"&gt;
                    &lt;div className="bg-white shadow rounded-lg p-6"&gt;
                        &lt;div className="flex items-center justify-between mb-6"&gt;
                            &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Erro&lt;/h1&gt;
                            &lt;button
                                onClick={() =&gt; router.back()}
                                className="bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded"
                            &gt;
                                &amp;larr; Voltar
                            &lt;/button&gt;
                        &lt;/div&gt;
                        &lt;div className="text-center"&gt;
                            &lt;i className="fas fa-exclamation-circle text-3xl text-red-600 mb-4"&gt;&lt;/i&gt;
                            &lt;p className="text-gray-600"&gt;{error || 'Contato n√£o encontrado'}&lt;/p&gt;
                            &lt;button
                                onClick={() =&gt; router.push('/')}
                                className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                            &gt;
                                Ir para Lista de Contatos
                            &lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }

    return (
        &lt;div className="min-h-screen bg-gray-50 p-6"&gt;
            &lt;div className="max-w-2xl mx-auto"&gt;
                &lt;div className="bg-white shadow rounded-lg p-6"&gt;
                    &lt;div className="flex items-center justify-between mb-6"&gt;
                        &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Detalhes do Contato&lt;/h1&gt;
                        &lt;button
                            onClick={() =&gt; router.back()}
                            className="bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded"
                        &gt;
                            &amp;larr; Voltar
                        &lt;/button&gt;
                    &lt;/div&gt;

                    &lt;div className="space-y-4"&gt;
                        &lt;div&gt;
                            &lt;label className="block text-sm font-medium text-gray-700 mb-1"&gt;ID&lt;/label&gt;
                            &lt;p className="text-gray-500 text-sm"&gt;{contact.id}&lt;/p&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label className="block text-sm font-medium text-gray-700 mb-1"&gt;Nome&lt;/label&gt;
                            &lt;p className="text-gray-900 text-lg"&gt;{contact.nome}&lt;/p&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label className="block text-sm font-medium text-gray-700 mb-1"&gt;Email&lt;/label&gt;
                            &lt;p className="text-gray-900"&gt;
                                {contact.email ? (
                                    &lt;a href={`mailto:${contact.email}`} className="text-blue-600 hover:underline"&gt;
                                        {contact.email}
                                    &lt;/a&gt;
                                ) : (
                                    &lt;span className="text-gray-500"&gt;N√£o informado&lt;/span&gt;
                                )}
                            &lt;/p&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label className="block text-sm font-medium text-gray-700 mb-1"&gt;Telefone&lt;/label&gt;
                            &lt;p className="text-gray-900"&gt;
                                {contact.telefone ? (
                                    &lt;a href={`tel:${contact.telefone}`} className="text-blue-600 hover:underline"&gt;
                                        {contact.telefone}
                                    &lt;/a&gt;
                                ) : (
                                    &lt;span className="text-gray-500"&gt;N√£o informado&lt;/span&gt;
                                )}
                            &lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    );
};

export default ContactDetailPage;</code></pre>

        <div class="alert alert-success">
          <strong>Vantagens da refatora√ß√£o com Context:</strong>
          <ul>
            <li>
              ‚úÖ <strong>Dados centralizados:</strong> Contatos gerenciados pelo
              Context
            </li>
            <li>
              ‚úÖ <strong>Performance:</strong> N√£o precisa fazer nova requisi√ß√£o
              √† API
            </li>
            <li>
              ‚úÖ <strong>Consist√™ncia:</strong> Dados sempre sincronizados com a
              lista principal
            </li>
            <li>
              ‚úÖ <strong>Fallback inteligente:</strong> Recarrega contatos se
              n√£o encontrar
            </li>
            <li>
              ‚úÖ <strong>Manuten√ß√£o:</strong> L√≥gica de API centralizada no
              Context
            </li>
          </ul>
        </div>

        <h4>5.4 ConnectionStatus com Hook Customizado</h4>
        <p>Vamos refatorar o ConnectionStatus para usar o hook customizado:</p>

        <pre><code class="language-jsx">// components/ConnectionStatus.jsx (MODIFICAR ARQUIVO EXISTENTE)
import { useConnectionStatus } from "../hooks/useConnectionStatus";

const ConnectionStatus = () => {
    const { isOnline, showStatus } = useConnectionStatus();

    return (
        &lt;div className={`flex items-center space-x-2 px-3 py-1 rounded-full text-sm transition-all duration-300 ${isOnline
            ? 'bg-green-100 text-green-800'
            : 'bg-orange-100 text-orange-800'
            }`}&gt;
            &lt;div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-green-500' : 'bg-orange-500'
                }`}&gt;&lt;/div&gt;
            &lt;span&gt;
                {isOnline ? 'Online' : 'Offline'}
            &lt;/span&gt;
            {isOnline && showStatus && (
                &lt;span className="text-xs"&gt;‚úì Sincronizado&lt;/span&gt;
            )}
        &lt;/div&gt;
    );
};

export default ConnectionStatus;</code></pre>
      </div>
    </div>
  </section>

  <!-- 6. Vantagens da Refatora√ß√£o -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-check-circle"></i> 6. Vantagens da Refatora√ß√£o
    </h3>

    <div class="card mb-4">
      <div class="card-body">
        <h4>6.1 Antes vs Depois</h4>

        <h5>‚ùå Antes (Props Drilling)</h5>
        <pre><code class="language-jsx">// P√°gina principal
const HomePage = () => {
  const [contacts, setContacts] = useState([]);
  const [loading, setLoading] = useState(false);
  // ... muita l√≥gica
  
  return (
    &lt;div&gt;
      &lt;ContactForm onAdd={handleAdd} /&gt;
      &lt;ContactList items={contacts} onRemove={handleRemove} /&gt;
      &lt;ContactItem contact={contact} onRemove={handleRemove} /&gt;
    &lt;/div&gt;
  );
};</code></pre>

        <h5>‚úÖ Depois (Context + Hooks)</h5>
        <pre><code class="language-jsx">// P√°gina principal
const HomePage = () => {
  return (
    &lt;ContactsProvider&gt;
      &lt;ContactsPage /&gt;
    &lt;/ContactsProvider&gt;
  );
};

// Componente interno
const ContactsPage = () => {
  const contactsData = useContactsContext();
  const { filteredContacts } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);
  
  return (
    &lt;div&gt;
      &lt;ContactForm /&gt; {/* Sem props! */}
      &lt;ContactList items={filteredContacts} /&gt;
      &lt;ContactItem contact={contact} /&gt; {/* Sem onRemove! */}
    &lt;/div&gt;
  );
};</code></pre>

        <h4>6.2 Benef√≠cios Alcan√ßados</h4>
        <ul>
          <li>
            ‚úÖ <strong>C√≥digo mais limpo:</strong> Menos props, mais
            legibilidade
          </li>
          <li>
            ‚úÖ <strong>Separa√ß√£o de responsabilidades:</strong> L√≥gica separada
            da apresenta√ß√£o
          </li>
          <li>
            ‚úÖ <strong>Reutiliza√ß√£o:</strong> Hooks podem ser usados em outros
            componentes
          </li>
          <li>
            ‚úÖ <strong>Testabilidade:</strong> Hooks podem ser testados
            isoladamente
          </li>
          <li>
            ‚úÖ <strong>Manutenibilidade:</strong> Mudan√ßas centralizadas no
            Context
          </li>
          <li>
            ‚úÖ <strong>Performance:</strong> Menos re-renders desnecess√°rios
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- 7. Exerc√≠cios Pr√°ticos -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-chalkboard-teacher"></i> 7. Exerc√≠cios Pr√°ticos
    </h3>

    <div class="desafio">
      <h4>Exerc√≠cio 1: Refatorar Projeto com Context</h4>
      <p>
        <strong>Objetivo:</strong> Refatorar o projeto de contatos da aula
        anterior para usar Context e hooks customizados.
      </p>
      <ol>
        <li>
          Manter todas as funcionalidades da aula 8 (API, cache, sincroniza√ß√£o,
          p√°gina de detalhes, exclus√£o)
        </li>
        <li>Criar ContactsContext com toda a l√≥gica de contatos</li>
        <li>
          Criar hooks customizados (useFilter, useStatistics,
          useConnectionStatus, useContactDetail, useForm)
        </li>
        <li>
          Refatorar componentes para usar hooks customizados em vez de props
        </li>
        <li>Refatorar p√°gina de detalhes para usar useContactDetail</li>
        <li>Organizar pastas (contexts/, hooks/, components/, utils/)</li>
        <li>Testar que todas as funcionalidades continuam funcionando</li>
      </ol>
      <details class="solucao">
        <summary>Mostrar solu√ß√£o</summary>
        <pre><code class="language-jsx">// contexts/ContactsContext.js (NOVO ARQUIVO)
import { createContext, useContext, useState, useEffect, useCallback } from 'react';
import api from '../utils/api';
import { cacheService } from '../utils/cache';

const ContactsContext = createContext();

export const useContactsContext = () => {
  const context = useContext(ContactsContext);
  if (!context) {
    throw new Error('useContactsContext deve ser usado dentro de ContactsProvider');
  }
  return context;
};

export const ContactsProvider = ({ children }) => {
  const [contacts, setContacts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isOffline, setIsOffline] = useState(false);

  const loadContacts = useCallback(async () => {
    let isMounted = true;

    try {
      if (isMounted) {
        setLoading(true);
        setError(null);
      }
      
      const cachedContacts = cacheService.get();
      if (cachedContacts && isMounted) {
        setContacts(cachedContacts);
        setLoading(false);
      }
      
      try {
        const response = await api.get('/contacts');
        const apiContacts = response.data;
        
        if (isMounted) {
          cacheService.set(apiContacts);
          setContacts(apiContacts);
          setIsOffline(false);
        }
      } catch (apiError) {
        if (isMounted) {
          if (!cachedContacts) {
            setIsOffline(true);
            setError('Erro ao carregar contatos e sem cache dispon√≠vel.');
          } else {
            setIsOffline(true);
            console.log('API offline, usando cache');
          }
        }
      }
    } catch (err) {
      if (isMounted) {
        setError('Erro ao carregar contatos');
      }
    } finally {
      if (isMounted) {
        setLoading(false);
      }
    }
  }, []);

  const addContact = useCallback(async (newContact) => {
    try {
      try {
        const response = await api.post('/contacts', newContact);
        const contactWithId = { ...newContact, id: response.data.id };
        setContacts(prev => {
          const updated = [...prev, contactWithId];
          cacheService.set(updated);
          return updated;
        });
        return contactWithId;
      } catch (apiError) {
        console.log('API offline, salvando localmente');
        const contactWithId = { ...newContact, id: Date.now() };
        setContacts(prev => {
          const updated = [...prev, contactWithId];
          cacheService.set(updated);
          return updated;
        });
        return contactWithId;
      }
    } catch (err) {
      throw new Error('Erro ao adicionar contato');
    }
  }, []);

  const removeContact = useCallback(async (id) => {
    try {
      // Tentar excluir via API primeiro
      try {
        await api.delete(`/contacts/${id}`);
        console.log('Contato exclu√≠do da API');
      } catch (apiError) {
        // Se API falhar, apenas remover localmente
        console.log('API offline, removendo apenas localmente');
      }
      
      // Remover da lista local em ambos os casos
      setContacts(prev => {
        const updated = prev.filter(c => c.id !== id);
        // Atualizar cache
        cacheService.set(updated);
        return updated;
      });
    } catch (err) {
      console.error('Erro ao remover contato:', err);
      throw new Error('Erro ao remover contato');
    }
  }, []);

  // Sincroniza√ß√£o online/offline
  useEffect(() => {
    const syncPendingContacts = async () => {
      try {
        const response = await api.get('/contacts');
        const serverContacts = response.data;
        
        const localContacts = contacts;
        
        const pendingContacts = localContacts.filter(localContact => {
          return typeof localContact.id === 'number' && 
                 localContact.id > 1000000000000 && 
                 !serverContacts.some(serverContact => 
                   serverContact.nome === localContact.nome &&
                   serverContact.email === localContact.email &&
                   serverContact.telefone === localContact.telefone
                 );
        });

        for (const pendingContact of pendingContacts) {
          try {
            const { id, ...contactData } = pendingContact;
            const response = await api.post('/contacts', contactData);
            
            setContacts(prev => prev.map(contact => 
              contact.id === pendingContact.id 
                ? { ...contact, id: response.data.id }
                : contact
            ));
            
            console.log('Contato sincronizado:', contactData.nome);
          } catch (err) {
            console.error('Erro ao sincronizar contato:', err);
          }
        }

        setContacts(serverContacts);
        cacheService.set(serverContacts);
        
      } catch (err) {
        console.error('Erro na sincroniza√ß√£o:', err);
      }
    };

    const handleOnline = () => {
      setIsOffline(false);
      console.log('Voltou online - sincronizando...');
      syncPendingContacts();
    };

    const handleOffline = () => {
      setIsOffline(true);
      console.log('Ficou offline - usando cache local');
    };

    setIsOffline(!navigator.onLine);
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, [contacts]);

  useEffect(() => {
    loadContacts();
  }, [loadContacts]);

  const value = {
    contacts,
    loading,
    error,
    isOffline,
    addContact,
    removeContact,
    loadContacts
  };

  return (
    &lt;ContactsContext.Provider value={value}&gt;
      {children}
    &lt;/ContactsContext.Provider&gt;
  );
};

export default ContactsContext;

// hooks/useFilter.js (NOVO ARQUIVO)
import { useState, useMemo, useCallback } from 'react';

export const useFilter = (contacts) => {
  const [filter, setFilter] = useState('');

  const handleFilterChange = useCallback((value) => {
    setFilter(value);
  }, []);

  const filteredContacts = useMemo(() => {
    if (!filter.trim()) {
      return contacts;
    }
    
    return contacts.filter(contact =>
      contact.nome.toLowerCase().includes(filter.toLowerCase()) ||
      contact.email.toLowerCase().includes(filter.toLowerCase()) ||
      contact.telefone.includes(filter)
    );
  }, [contacts, filter]);

  return {
    filter,
    filteredContacts,
    handleFilterChange
  };
};

// hooks/useStatistics.js (NOVO ARQUIVO)
import { useMemo } from 'react';

export const useStatistics = (contacts) => {
  const stats = useMemo(() => {
    const total = contacts.length;
    const comEmail = contacts.filter(c => c.email).length;
    const comTelefone = contacts.filter(c => c.telefone).length;
    
    return {
      total,
      comEmail,
      comTelefone,
      semEmail: total - comEmail,
      semTelefone: total - comTelefone
    };
  }, [contacts]);

  return stats;
};

// hooks/useConnectionStatus.js (NOVO ARQUIVO)
import { useState, useEffect } from 'react';

export const useConnectionStatus = () => {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [showStatus, setShowStatus] = useState(false);

  useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      setShowStatus(true);
      setTimeout(() => setShowStatus(false), 3000);
    };

    const handleOffline = () => {
      setIsOnline(false);
      setShowStatus(true);
    };

    setIsOnline(navigator.onLine);
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  return {
    isOnline,
    showStatus,
    setIsOnline,
    setShowStatus
  };
};

// app/page.js (MODIFICAR ARQUIVO EXISTENTE)
"use client";
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistics from "./components/Statistics";
import ConnectionStatus from "./components/ConnectionStatus";
import { ContactsProvider } from "./contexts/ContactsContext";
import { useContactsContext } from "./contexts/ContactsContext";
import { useFilter } from "./hooks/useFilter";
import { useStatistics } from "./hooks/useStatistics";

const ContactsPage = () => {
  const contactsData = useContactsContext();
  const { filter, filteredContacts, handleFilterChange } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);

  return (
    &lt;div className="min-h-screen bg-gray-200 p-6"&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold text-gray-900"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;FilterInput 
              value={filter} 
              onChange={handleFilterChange} 
            /&gt;
            &lt;ConnectionStatus /&gt;
          &lt;/div&gt;
        &lt;/header&gt;

        &lt;ContactForm /&gt;

        {contactsData.loading && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-spinner fa-spin text-2xl text-blue-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2"&gt;Carregando contatos...&lt;/p&gt;
          &lt;/div&gt;
        )}

        {contactsData.error && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-exclamation-circle text-2xl text-red-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2 text-red-600"&gt;{contactsData.error}&lt;/p&gt;
            &lt;button 
              onClick={contactsData.loadContacts}
              className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            &gt;
              Tentar Novamente
            &lt;/button&gt;
          &lt;/div&gt;
        )}

        {!contactsData.loading && !contactsData.error && (
          &lt;ContactList 
            items={filteredContacts} 
            onRemove={contactsData.removeContact} 
          /&gt;
        )}

        &lt;Statistics stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

const HomePage = () => {
  return (
    &lt;ContactsProvider&gt;
      &lt;ContactsPage /&gt;
    &lt;/ContactsProvider&gt;
  );
};

export default HomePage;</code></pre>
      </details>
    </div>

    <div class="desafio">
      <h4>Exerc√≠cio 2: Criar ThemeContext</h4>
      <p>
        <strong>Objetivo:</strong> Criar um Context para gerenciar tema
        claro/escuro no projeto de contatos.
      </p>
      <ol>
        <li>Criar ThemeContext com tema claro/escuro</li>
        <li>Criar hook useTheme</li>
        <li>Implementar toggle de tema</li>
        <li>Aplicar tema nos componentes do projeto</li>
        <li>Integrar com o ContactsContext existente</li>
      </ol>
      <details class="solucao">
        <summary>Mostrar solu√ß√£o</summary>
        <pre><code class="language-jsx">// contexts/ThemeContext.js (NOVO ARQUIVO)
import { createContext, useContext, useState, useEffect } from 'react';

const ThemeContext = createContext();

export const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useState('light');

  // Carregar tema do localStorage
  useEffect(() => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setTheme(savedTheme);
    }
  }, []);

  // Salvar tema no localStorage
  useEffect(() => {
    localStorage.setItem('theme', theme);
    document.documentElement.className = theme;
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  const value = {
    theme,
    toggleTheme,
    isDark: theme === 'dark'
  };

  return (
    &lt;ThemeContext.Provider value={value}&gt;
      {children}
    &lt;/ThemeContext.Provider&gt;
  );
};

// hooks/useTheme.js (NOVO ARQUIVO)
export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme deve ser usado dentro de ThemeProvider');
  }
  return context;
};

// components/ThemeToggle.jsx (NOVO ARQUIVO)
import { useTheme } from '../hooks/useTheme';

const ThemeToggle = () => {
  const { theme, toggleTheme } = useTheme();

  return (
    &lt;button
      onClick={toggleTheme}
      className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
    &gt;
      {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
    &lt;/button&gt;
  );
};

export default ThemeToggle;

// app/layout.js (MODIFICAR ARQUIVO EXISTENTE)
import { ThemeProvider } from './contexts/ThemeContext';
import { ContactsProvider } from './contexts/ContactsContext';

export default function RootLayout({ children }) {
  return (
    &lt;html lang="pt-BR"&gt;
      &lt;body&gt;
        &lt;ThemeProvider&gt;
          &lt;ContactsProvider&gt;
            {children}
          &lt;/ContactsProvider&gt;
        &lt;/ThemeProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}

// app/page.js (MODIFICAR ARQUIVO EXISTENTE)
"use client";
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistics from "./components/Statistics";
import ConnectionStatus from "./components/ConnectionStatus";
import ThemeToggle from "./components/ThemeToggle";
import { useContactsContext } from "./contexts/ContactsContext";
import { useTheme } from "./hooks/useTheme";
import { useFilter } from "./hooks/useFilter";
import { useStatistics } from "./hooks/useStatistics";

const ContactsPage = () => {
  const contactsData = useContactsContext();
  const { isDark } = useTheme();
  const { filter, filteredContacts, handleFilterChange } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);

  return (
    &lt;div className={`min-h-screen p-6 transition-colors ${
      isDark ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-900'
    }`}&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;FilterInput 
              value={filter} 
              onChange={handleFilterChange} 
            /&gt;
            &lt;ConnectionStatus /&gt;
            &lt;ThemeToggle /&gt;
          &lt;/div&gt;
        &lt;/header&gt;

        &lt;ContactForm /&gt;

        {contactsData.loading && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-spinner fa-spin text-2xl text-blue-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2"&gt;Carregando contatos...&lt;/p&gt;
          &lt;/div&gt;
        )}

        {contactsData.error && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-exclamation-circle text-2xl text-red-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2 text-red-600"&gt;{contactsData.error}&lt;/p&gt;
            &lt;button 
              onClick={contactsData.loadContacts}
              className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            &gt;
              Tentar Novamente
            &lt;/button&gt;
          &lt;/div&gt;
        )}

        {!contactsData.loading && !contactsData.error && (
          &lt;ContactList 
            items={filteredContacts} 
            onRemove={contactsData.removeContact} 
          /&gt;
        )}

        &lt;Statistics stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default ContactsPage;</code></pre>
      </details>
    </div>

    <div class="desafio">
      <h4>Exerc√≠cio 3: Hook useLocalStorage</h4>
      <p>
        <strong>Objetivo:</strong> Criar hook customizado para localStorage que
        pode ser usado em qualquer parte do projeto.
      </p>
      <ol>
        <li>Criar hook useLocalStorage</li>
        <li>Implementar sincroniza√ß√£o autom√°tica entre abas</li>
        <li>Adicionar tratamento de erros</li>
        <li>Usar no projeto para configura√ß√µes do usu√°rio</li>
        <li>Integrar com o ThemeContext</li>
      </ol>
      <details class="solucao">
        <summary>Mostrar solu√ß√£o</summary>
        <pre><code class="language-jsx">// hooks/useLocalStorage.js (NOVO ARQUIVO)
import { useState, useEffect, useCallback } from 'react';

const useLocalStorage = (key, initialValue) => {
  // Estado para armazenar o valor
  const [storedValue, setStoredValue] = useState(() => {
    try {
      // Tentar obter do localStorage
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(`Erro ao ler localStorage key "${key}":`, error);
      return initialValue;
    }
  });

  // Fun√ß√£o para atualizar o valor
  const setValue = useCallback((value) => {
    try {
      // Permitir que value seja uma fun√ß√£o
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      
      // Salvar no estado
      setStoredValue(valueToStore);
      
      // Salvar no localStorage
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(`Erro ao salvar localStorage key "${key}":`, error);
    }
  }, [key, storedValue]);

  // Fun√ß√£o para remover do localStorage
  const removeValue = useCallback(() => {
    try {
      window.localStorage.removeItem(key);
      setStoredValue(initialValue);
    } catch (error) {
      console.error(`Erro ao remover localStorage key "${key}":`, error);
    }
  }, [key, initialValue]);

  // Sincronizar com mudan√ßas em outras abas
  useEffect(() => {
    const handleStorageChange = (e) => {
      if (e.key === key && e.newValue !== null) {
        try {
          setStoredValue(JSON.parse(e.newValue));
        } catch (error) {
          console.error(`Erro ao sincronizar localStorage key "${key}":`, error);
        }
      }
    };

    window.addEventListener('storage', handleStorageChange);
    return () => window.removeEventListener('storage', handleStorageChange);
  }, [key]);

  return [storedValue, setValue, removeValue];
};

export default useLocalStorage;

// contexts/ThemeContext.js (MODIFICAR ARQUIVO EXISTENTE)
import { createContext, useContext } from 'react';
import useLocalStorage from '../hooks/useLocalStorage';

const ThemeContext = createContext();

export const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useLocalStorage('theme', 'light');

  // Salvar tema no DOM
  useEffect(() => {
    document.documentElement.className = theme;
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  const value = {
    theme,
    toggleTheme,
    isDark: theme === 'dark'
  };

  return (
    &lt;ThemeContext.Provider value={value}&gt;
      {children}
    &lt;/ThemeContext.Provider&gt;
  );
};

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme deve ser usado dentro de ThemeProvider');
  }
  return context;
};

// components/Settings.jsx (NOVO ARQUIVO)
import { useLocalStorage } from '../hooks/useLocalStorage';
import { useTheme } from '../hooks/useTheme';

const Settings = () => {
  const [language, setLanguage] = useLocalStorage('language', 'pt-BR');
  const [notifications, setNotifications] = useLocalStorage('notifications', true);
  const [autoSync, setAutoSync] = useLocalStorage('autoSync', true);
  const { theme, toggleTheme } = useTheme();

  return (
    &lt;div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow"&gt;
      &lt;h2 className="text-xl font-bold mb-6 text-gray-900 dark:text-white"&gt;
        Configura√ß√µes
      &lt;/h2&gt;
      
      &lt;div className="space-y-6"&gt;
        {/* Tema */}
        &lt;div&gt;
          &lt;label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300"&gt;
            Tema
          &lt;/label&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;span className="text-sm text-gray-600 dark:text-gray-400"&gt;
              {theme === 'light' ? 'Claro' : 'Escuro'}
            &lt;/span&gt;
            &lt;button
              onClick={toggleTheme}
              className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
            &gt;
              {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        {/* Idioma */}
        &lt;div&gt;
          &lt;label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300"&gt;
            Idioma
          &lt;/label&gt;
          &lt;select 
            value={language} 
            onChange={(e) => setLanguage(e.target.value)}
            className="border rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          &gt;
            &lt;option value="pt-BR"&gt;Portugu√™s&lt;/option&gt;
            &lt;option value="en-US"&gt;English&lt;/option&gt;
            &lt;option value="es-ES"&gt;Espa√±ol&lt;/option&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        {/* Notifica√ß√µes */}
        &lt;div&gt;
          &lt;label className="flex items-center"&gt;
            &lt;input 
              type="checkbox" 
              checked={notifications}
              onChange={(e) => setNotifications(e.target.checked)}
              className="mr-3 rounded"
            /&gt;
            &lt;span className="text-sm text-gray-700 dark:text-gray-300"&gt;
              Receber notifica√ß√µes
            &lt;/span&gt;
          &lt;/label&gt;
        &lt;/div&gt;

        {/* Sincroniza√ß√£o Autom√°tica */}
        &lt;div&gt;
          &lt;label className="flex items-center"&gt;
            &lt;input 
              type="checkbox" 
              checked={autoSync}
              onChange={(e) => setAutoSync(e.target.checked)}
              className="mr-3 rounded"
            /&gt;
            &lt;span className="text-sm text-gray-700 dark:text-gray-300"&gt;
              Sincroniza√ß√£o autom√°tica
            &lt;/span&gt;
          &lt;/label&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {/* Bot√£o para limpar todas as configura√ß√µes */}
      &lt;div className="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"&gt;
        &lt;button
          onClick={() => {
            setLanguage('pt-BR');
            setNotifications(true);
            setAutoSync(true);
            toggleTheme(); // Voltar para tema claro
          }}
          className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
        &gt;
          Restaurar Padr√µes
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default Settings;

// app/page.js (MODIFICAR ARQUIVO EXISTENTE)
"use client";
import ContactForm from "./components/ContactForm";
import ContactList from "./components/ContactList";
import FilterInput from "./components/FilterInput";
import Statistics from "./components/Statistics";
import ConnectionStatus from "./components/ConnectionStatus";
import ThemeToggle from "./components/ThemeToggle";
import Settings from "./components/Settings";
import { ContactsProvider } from "./contexts/ContactsContext";
import { useContactsContext } from "./contexts/ContactsContext";
import { useTheme } from "./hooks/useTheme";
import { useFilter } from "./hooks/useFilter";
import { useStatistics } from "./hooks/useStatistics";
import { useState } from "react";

const ContactsPage = () => {
  const contactsData = useContactsContext();
  const { isDark } = useTheme();
  const { filter, filteredContacts, handleFilterChange } = useFilter(contactsData.contacts);
  const stats = useStatistics(contactsData.contacts);
  const [showSettings, setShowSettings] = useState(false);

  return (
    &lt;div className={`min-h-screen p-6 transition-colors ${
      isDark ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-900'
    }`}&gt;
      &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
        &lt;header className="flex items-center justify-between"&gt;
          &lt;h1 className="text-2xl font-bold"&gt;Cadastro de Contatos&lt;/h1&gt;
          &lt;div className="flex items-center space-x-4"&gt;
            &lt;FilterInput 
              value={filter} 
              onChange={handleFilterChange} 
            /&gt;
            &lt;ConnectionStatus /&gt;
            &lt;ThemeToggle /&gt;
            &lt;button
              onClick={() => setShowSettings(!showSettings)}
              className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
              title="Configura√ß√µes"
            &gt;
              ‚öôÔ∏è
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/header&gt;

        {showSettings && (
          &lt;Settings /&gt;
        )}

        &lt;ContactForm /&gt;

        {contactsData.loading && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-spinner fa-spin text-2xl text-blue-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2"&gt;Carregando contatos...&lt;/p&gt;
          &lt;/div&gt;
        )}

        {contactsData.error && (
          &lt;div className="text-center py-8"&gt;
            &lt;i className="fas fa-exclamation-circle text-2xl text-red-600"&gt;&lt;/i&gt;
            &lt;p className="mt-2 text-red-600"&gt;{contactsData.error}&lt;/p&gt;
            &lt;button 
              onClick={contactsData.loadContacts}
              className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            &gt;
              Tentar Novamente
            &lt;/button&gt;
          &lt;/div&gt;
        )}

        {!contactsData.loading && !contactsData.error && (
          &lt;ContactList 
            items={filteredContacts} 
            onRemove={contactsData.removeContact} 
          /&gt;
        )}

        &lt;Statistics stats={stats} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

const HomePage = () => {
  return (
    &lt;ContactsProvider&gt;
      &lt;ContactsPage /&gt;
    &lt;/ContactsProvider&gt;
  );
};

export default HomePage;</code></pre>
      </details>
    </div>
  </section>

  <!-- 8. Resumo Final -->
  <section class="mb-5">
    <h3 class="section-title with-icon">
      <i class="fas fa-check-circle"></i> 8. Resumo Final
    </h3>
    <div class="card mb-4">
      <div class="card-body">
        <h4>O que foi Mantido da Aula Anterior (React 8)</h4>
        <ul>
          <li>
            ‚úÖ <strong>Integra√ß√£o com MockAPI:</strong> axios configurado e
            funcionando
          </li>
          <li>
            ‚úÖ <strong>Cache Service:</strong> Sistema de cache com expira√ß√£o
            (utils/cache.js)
          </li>
          <li>
            ‚úÖ <strong>Sincroniza√ß√£o Online/Offline:</strong> Detec√ß√£o
            autom√°tica e sincroniza√ß√£o
          </li>
          <li>
            ‚úÖ <strong>Estados de UI:</strong> Loading, erro e indicador offline
          </li>
          <li>
            ‚úÖ <strong>Componente ConnectionStatus:</strong> Indicador visual de
            conex√£o
          </li>
          <li>
            ‚úÖ <strong>Otimiza√ß√µes:</strong> useMemo, useCallback, useRef
            mantidos
          </li>
          <li>
            ‚úÖ <strong>Componente Statistics:</strong> Separado e funcionando
          </li>
          <li>
            ‚úÖ <strong>P√°gina de Detalhes:</strong> Busca da API com fallback
            offline
          </li>
          <li>
            ‚úÖ <strong>Exclus√£o de Contatos:</strong> Funcionando com API e
            offline
          </li>
          <li>‚úÖ <strong>Filtros:</strong> Busca em tempo real otimizada</li>
        </ul>

        <h4>O que foi Adicionado Nesta Aula (React 9)</h4>
        <ul>
          <li>
            üÜï <strong>ContactsContext:</strong> Estado global para contatos,
            loading, erro, isOffline
          </li>
          <li>
            üÜï <strong>useContactsContext:</strong> Hook para acessar o Context
          </li>
          <li>
            üÜï <strong>useFilter:</strong> Hook customizado para gerenciar
            filtros
          </li>
          <li>
            üÜï <strong>useStatistics:</strong> Hook customizado para calcular
            estat√≠sticas
          </li>
          <li>
            üÜï <strong>useConnectionStatus:</strong> Hook para status de conex√£o
          </li>
          <li>
            üÜï <strong>useContactDetail:</strong> Hook para buscar contato
            espec√≠fico por ID
          </li>
          <li>
            üÜï <strong>useForm:</strong> Hook para gerenciar formul√°rios e
            remo√ß√£o de contatos
          </li>
          <li>
            üÜï <strong>getContact:</strong> Fun√ß√£o no Context para buscar
            contato espec√≠fico
          </li>
          <li>
            üÜï <strong>Organiza√ß√£o:</strong> Pastas contexts/ e hooks/ para
            melhor estrutura
          </li>
          <li>
            üÜï <strong>Refatora√ß√£o:</strong> Componentes usam hooks customizados
            em vez de props
          </li>
          <li>
            üÜï <strong>Elimina√ß√£o de Props Drilling:</strong> Dados acess√≠veis
            globalmente
          </li>
        </ul>

        <h4>Benef√≠cios da Refatora√ß√£o</h4>
        <ul>
          <li>
            ‚úÖ <strong>C√≥digo mais limpo:</strong> Menos props, mais
            legibilidade
          </li>
          <li>
            ‚úÖ <strong>Separa√ß√£o de responsabilidades:</strong> L√≥gica separada
            da apresenta√ß√£o
          </li>
          <li>
            ‚úÖ <strong>Reutiliza√ß√£o:</strong> Hooks podem ser usados em outros
            componentes
          </li>
          <li>
            ‚úÖ <strong>Testabilidade:</strong> Hooks podem ser testados
            isoladamente
          </li>
          <li>
            ‚úÖ <strong>Manutenibilidade:</strong> Mudan√ßas centralizadas no
            Context
          </li>
          <li>
            ‚úÖ <strong>Performance:</strong> Menos re-renders desnecess√°rios
          </li>
          <li>
            ‚úÖ <strong>Escalabilidade:</strong> F√°cil adicionar novos estados
            globais
          </li>
        </ul>

        <h4>Estrutura Final do Projeto</h4>
        <pre><code class="language-plaintext">app/
‚îú‚îÄ‚îÄ page.js                    # P√°gina principal (refatorada com Context)
‚îú‚îÄ‚îÄ layout.js                  # Layout compartilhado (com ContactsProvider)
‚îú‚îÄ‚îÄ globals.css                # Estilos globais
‚îú‚îÄ‚îÄ contact/[id]/page.js       # P√°gina de detalhes (usa useContactDetail)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ContactForm.jsx        # Formul√°rio (usa useForm)
‚îÇ   ‚îú‚îÄ‚îÄ ContactList.jsx        # Lista de contatos
‚îÇ   ‚îú‚îÄ‚îÄ ContactItem.jsx        # Item individual (usa useForm)
‚îÇ   ‚îú‚îÄ‚îÄ FilterInput.jsx        # Campo de filtro
‚îÇ   ‚îú‚îÄ‚îÄ Statistics.jsx         # Estat√≠sticas
‚îÇ   ‚îî‚îÄ‚îÄ ConnectionStatus.jsx   # Status de conex√£o (usa useConnectionStatus)
‚îú‚îÄ‚îÄ contexts/                  # Contexts para estado global
‚îÇ   ‚îî‚îÄ‚îÄ ContactsContext.js     # Context de contatos (com getContact)
‚îú‚îÄ‚îÄ hooks/                     # Hooks customizados
‚îÇ   ‚îú‚îÄ‚îÄ useFilter.js           # Hook para filtros
‚îÇ   ‚îú‚îÄ‚îÄ useStatistics.js       # Hook para estat√≠sticas
‚îÇ   ‚îú‚îÄ‚îÄ useConnectionStatus.js # Hook para status de conex√£o
‚îÇ   ‚îú‚îÄ‚îÄ useContactDetail.js    # Hook para buscar contato espec√≠fico
‚îÇ   ‚îî‚îÄ‚îÄ useForm.js             # Hook para gerenciar formul√°rios
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ api.js                 # Configura√ß√£o do axios (mantido)
    ‚îî‚îÄ‚îÄ cache.js               # Servi√ßo de cache (mantido)</code></pre>

        <h4>Pr√≥ximos Passos</h4>
        <ul>
          <li>
            üîÆ <strong>React Query:</strong> Para cache e sincroniza√ß√£o de dados
            mais avan√ßada
          </li>
          <li>
            üîÆ <strong>Zustand:</strong> Para gerenciamento de estado mais
            simples
          </li>
          <li>
            üîÆ <strong>Redux Toolkit:</strong> Para aplica√ß√µes mais complexas
          </li>
          <li>
            üîÆ <strong>React Hook Form:</strong> Para formul√°rios mais robustos
          </li>
          <li>
            üîÆ <strong>Compound Components:</strong> Componentes compostos
          </li>
          <li>
            üîÆ <strong>Custom Hooks Library:</strong> Biblioteca de hooks
            reutiliz√°veis
          </li>
        </ul>

        <div class="alert alert-success">
          <strong>Parab√©ns!</strong> Voc√™ agora sabe como usar useContext e
          hooks customizados para organizar melhor aplica√ß√µes React, mantendo
          todas as funcionalidades avan√ßadas como API, cache offline e
          sincroniza√ß√£o autom√°tica. Essas s√£o habilidades essenciais para
          desenvolvimento de aplica√ß√µes modernas e escal√°veis!
        </div>
      </div>
    </div>
  </section>
</article>
